
{
  "entities": {
    "Employee": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Employee",
      "type": "object",
      "description": "Master record for an employee's organizational and personal data. This is the single source of truth for personnel information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the employee, typically matching the Firebase Auth UID if they are a system user."
        },
        "name": {
          "type": "string",
          "description": "The full name of the employee."
        },
        "email": {
          "type": "string",
          "description": "The employee's contact email address.",
          "format": "email"
        },
        "departmentId": {
          "type": "string",
          "description": "Foreign key referencing the 'departments' collection."
        },
        "positionId": {
          "type": "string",
          "description": "Foreign key referencing the 'positions' collection."
        },
        "managerId": {
          "type": "string",
          "description": "The ID of the employee's direct manager. This is a self-referencing foreign key to another employee's ID."
        },
        "level": {
            "type": "number",
            "description": "Organizational level of the employee, often derived from their position."
        },
        "status": {
          "type": "string",
          "enum": ["active", "inactive", "resigned"],
          "description": "The current employment status of the employee."
        }
      },
      "required": ["id", "name", "email", "status"]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Stores application-specific authentication and authorization data for an employee who has system access.",
      "properties": {
        "id": {
          "type": "string",
          "description": "The user's UID from Firebase Authentication, which must match their employee ID."
        },
        "employeeId": {
          "type": "string",
          "description": "Foreign key referencing the 'employees' collection."
        },
        "email": {
          "type": "string",
          "description": "The user's login email address.",
          "format": "email"
        },
        "roles": {
          "type": "array",
          "description": "An array of role codes (strings) assigned to the user, referencing the 'roles' collection.",
          "items": {
            "type": "string"
          }
        },
        "menuAccess": {
            "type": "object",
            "description": "A map of navigation items and whether the user has access. Typically derived from assigned roles."
        }
      },
      "required": ["id", "employeeId", "email", "roles"]
    },
    "Department": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Department",
      "type": "object",
      "description": "Defines a department or business unit within the organization.",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string", "description": "The full name of the department." },
        "nameTH": { "type": "string", "description": "The name of the department in Thai." },
        "parentDepartmentId": { "type": "string", "description": "FK to another department for sub-department structures." },
        "headOfDepartmentId": { "type": "string", "description": "FK to the employee who is the head of this department." }
      },
      "required": ["id", "name"]
    },
    "Position": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Position",
      "type": "object",
      "description": "Defines a job position within the organization, including its level and default roles.",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string", "description": "The name of the position (e.g., 'Senior Manager')." },
        "nameTH": { "type": "string", "description": "The name of the position in Thai." },
        "level": { "type": "number", "description": "The hierarchical level of the position (e.g., 5 for manager, 1 for staff)." },
        "category": { "type": "string", "enum": ["management", "specialist", "staff"] },
        "defaultRoles": { "type": "array", "items": { "type": "string" } }
      },
      "required": ["id", "name", "level"]
    },
    "Role": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Role",
      "type": "object",
      "description": "Defines a role within the application, mapping to a set of permissions.",
      "properties": {
        "id": { "type": "string" },
        "code": { "type": "string", "description": "A short code for the role (e.g., 'manager')." },
        "name": { "type": "string", "description": "The display name of the role." },
        "defaultPermissions": { "type": "object" },
        "menuAccess": { "type": "object" }
      },
      "required": ["id", "code", "name"]
    },
    "Kpi": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Kpi",
      "type": "object",
      "description": "Represents a Key Performance Indicator.",
      "properties": {
        "id": { "type": "string" },
        "measure": { "type": "string" },
        "target": { "type": "string" },
        "unit": { "type": "string" },
        "perspective": { "type": "string" },
        "category": { "type": "string" }
      },
      "required": ["id", "measure", "target"]
    },
    "IndividualKpi": {
        "title": "IndividualKpi",
        "type": "object",
        "properties": {
          "employeeId": { "type": "string" },
          "kpiMeasure": { "type": "string" },
          "weight": { "type": "number" },
          "status": { "type": "string" },
          "type": { "type": "string", "enum": ["cascaded", "committed"] }
        }
    },
    "KpiSubmission": {
        "title": "KpiSubmission",
        "type": "object",
        "properties": {
            "kpiId": { "type": "string" },
            "submittedBy": { "type": "string" },
            "actualValue": { "type": "string" },
            "status": { "type": "string" }
        }
    },
    "MonthlyKpi": {
        "title": "MonthlyKpi",
        "type": "object",
        "properties": {
            "parentKpiId": { "type": "string" },
            "month": { "type": "number" },
            "year": { "type": "number" },
            "target": { "type": "number" },
            "actual": { "type": "number" }
        }
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ],
    "customClaims": {
      "role": {
        "type": "string",
        "enum": [
          "Admin",
          "VP",
          "AVP",
          "Manager",
          "Employee"
        ]
      }
    }
  },
  "firestore": {
    "structure": [
      {
        "path": "/employees/{employeeId}",
        "definition": { "schema": { "$ref": "#/entities/Employee" } }
      },
      {
        "path": "/users/{userId}",
        "definition": { "schema": { "$ref": "#/entities/User" } }
      },
      {
        "path": "/departments/{departmentId}",
        "definition": { "schema": { "$ref": "#/entities/Department" } }
      },
      {
        "path": "/positions/{positionId}",
        "definition": { "schema": { "$ref": "#/entities/Position" } }
      },
      {
        "path": "/roles/{roleId}",
        "definition": { "schema": { "$ref": "#/entities/Role" } }
      },
      {
        "path": "/kpi_catalog/{kpiId}",
        "definition": { "schema": { "$ref": "#/entities/Kpi" } }
      },
      {
        "path": "/individual_kpis/{individualKpiId}",
        "definition": { "schema": { "$ref": "#/entities/IndividualKpi" } }
      },
       {
        "path": "/kpi_submissions/{submissionId}",
        "definition": { "schema": { "$ref": "#/entities/KpiSubmission" } }
      },
      {
        "path": "/monthly_kpis/{monthlyKpiId}",
        "definition": { "schema": { "$ref": "#/entities/MonthlyKpi" } }
      }
    ],
    "reasoning": "The data model has been fully normalized to establish a single source of truth. 'employees' is the master for HR data. 'users' is for authentication and roles, linked via employeeId. 'departments', 'positions', and 'roles' are now separate, configurable collections, allowing for a highly flexible and scalable organizational structure. This eliminates data duplication and inconsistency."
  }
}
